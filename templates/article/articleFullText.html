<template name="ArticleText">
    <div class="row">
        <div class="page-content col s12 m12 l8">
            {{#with article}}
                {{>ArticleHeader}}

                {{#if ids.pii}}
                {{else}}
                    <div class="center-align"><h4>Full Text Unavailable.</h4></div>
                {{/if}}
            {{/with}}

            {{#if fullText}}
            {{else}}
                {{>Loading}}
            {{/if}}

            {{#with fullText}}
                <div class="article-text">
                    {{>ArticleFullText}}

                    {{#if glossary}}
                        {{>ArticleGlossary}}
                    {{/if}}

                    {{#if acks}}
                        {{#each acks}}
                        <h3 id="{{convertToID title}}" class="article-header-1">{{title}}</h3>
                            {{#each content}}
                                {{#if equals contentType 'p'}}
                                    <p>{{{content}}}</p>
                                {{/if}}
                            {{/each}}
                        {{/each}}
                    {{/if}}


                    {{#if footnotes}}
                        {{#each footnotes}}
                        <h3 id="{{convertToID title}}" class="article-header-1">{{title}}</h3>
                            {{#each content}}
                            <p>{{#if label}}<sup>{{{label}}}</sup>{{/if}}{{{content_part}}}</p>
                            {{/each}}
                        {{/each}}
                    {{/if}}

                    {{#if references}}
                        <h3 id="references">References</h3>
                        <ul>
                            {{#each references}}
                                <li id="R{{number}}">
                                    <b>{{#if label}}{{label}}{{else}}{{number}}{{/if}}.</b>

                                    {{#if asString}}
                                        {{{asString}}}
                                    {{else}}

                                    {{#if equals type 'journal'}}
                                    {{#if editors}}<span> {{editors}}, editor.</span>{{/if}}
                                    {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
                                    {{#if title}}<span> {{{title}}}{{punctuationCheck title}}</span>{{/if}}
                                    {{#if source}}<span> {{source}}.</span>{{/if}}
                                    {{#if year}}<span> {{year}}</span>{{/if}}{{referenceSemicolonCheck reference=this}}{{#if volume}}<span> {{volume}}</span>{{/if}}{{#if issue}}<span>({{issue}})</span>{{/if}}{{referenceColonCheck reference=this}}{{#if fpage}}<span> {{fpage}}</span>{{/if}}{{#if lpage}}<span>-{{lpage}}</span>.{{/if}}
                                    {{#if comment}}<span> {{{comment}}}</span>{{/if}}
                                    {{#if doi}}<span>doi: {{doi}}</span>.{{/if}}
                                    {{#if pmid}}<span> [<a href="http://www.ncbi.nlm.nih.gov/pubmed/{{pmid}}" target="_BLANK">PubMed</a>]</span>{{/if}}
                                    {{/if}}

                                    {{#if equals type 'book'}}

                                        {{! Book refs are handled differently if they are chapter specific refs}}
                                        {{#if chapter_title}}

                                            {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
                                            {{#if chapter_title}}<span> {{{chapter_title}}}.</span>{{/if}}
                                            {{#if source}}<span>In: </span>{{/if}}
                                            {{#if editors}}<span> {{editors}}, eds.</span>{{/if}}
                                            {{#if source}}<span>{{{source}}}.</span>{{/if}}
                                            {{#if volume}}<span> {{volume}}:</span>{{/if}}
                                            {{#if publisher_loc}}<span>{{{publisher_loc}}}</span>{{/if}}
                                            {{#if publisher_name}}: <span>{{{publisher_name}}}</span>{{/if}}{{#if year}}<span>, {{year}}</span>{{/if}}{{#if fpage}}<span>, pp. {{fpage}}</span>{{/if}}{{#if lpage}}<span>-{{lpage}}</span>{{/if}}<span>.</span>

                                        {{! This is the non-chapter specific ref, for a whole book}}
                                        {{else}}

                                            {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
                                            {{#if year}}<span> {{year}}.</span>{{/if}}
                                            {{#if title}}<span> {{{title}}}.</span>{{/if}}
                                            {{#if chapter_title}}<span> {{{chapter_title}}}.</span>{{/if}}
                                            {{#if fpage}}<span> {{fpage}}</span>{{/if}}{{#if lpage}}<span>-{{lpage}}</span>{{/if}}
                                            {{#if source}}<span>{{{source}}}</span>{{/if}}<span>(</span>{{#if publisher_loc}}<span>{{{publisher_loc}}}</span>{{/if}}{{#if publisher_name}}: <span>{{{publisher_name}}}</span>{{/if}}<span>)</span><span>.</span>
                                        {{/if}}
                                    {{/if}}


                                    {{#if equals type 'web'}}
                                    {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
                                    {{#if title}}<span> {{{title}}}.</span>{{/if}}
                                    {{#if year}}<span> {{year}};</span>{{/if}}
                                    {{#if source}}<span> {{source}}.</span>{{/if}}
                                    {{#if comment}}<span>{{{comment}}}</span>{{/if}}
                                    {{/if}}

                                    {{#if equals type 'other'}}
                                    {{#if collab}}<span> {{collab}}.</span>{{/if}}
                                    {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
                                    {{#if title}}<span> {{{title}}}.</span>{{/if}}
                                    {{#if chapter_title}}<span> {{{chapter_title}}};</span>{{/if}}
                                    {{#if source}}<span> {{source}}.</span>{{/if}}
                                    {{#if comment}}<span> {{{comment}}}</span>{{/if}}
                                    {{#if year}}<span> {{year}}.</span>{{/if}}
                                    {{#if fpage}}<span> {{fpage}}</span>{{/if}}{{#if lpage}}<span>-{{lpage}}</span>.{{/if}}
                                    {{/if}}

                                    {{#if equals type 'conf_proc'}}
                                        {{>FullTextReferenceConference}}
                                    {{/if}}
                                    {{#if equals type 'confproc'}}
                                        {{>FullTextReferenceConference}}
                                    {{/if}}

                                    {{#if ext_link}}<a href="{{ext_link}}" target="_BLANK">{{ext_link}}</a>{{/if}}

                                    {{/if}}
                                </li>
                            {{/each}}
                        </ul>
                    {{/if}}
                </div>
            {{/with}}
        </div>

        {{> ArticleSidebar article=article related=fullText.related}}
    </div>
</template>

<template name="ArticleFullText">
    {{#if advanceContent}}
        {{{advanceContent}}}
    {{else}}
        {{#each sections}}
            {{>ArticleFullTextSection}}
        {{/each}}
    {{/if}}
</template>

<template name="ArticleFullTextSection">
    <div class="section-container" id="{{#if equals headerLevel 1}}{{convertToID title}}{{/if}}">
        {{#if title}}<h3 class="article-header-{{headerLevel}}">{{#if label}} {{{label}}}} {{/if}} {{{title}}}</h3>{{/if}}
        {{#each content}}
            {{#if equals contentType 'p'}}
            <p>{{{content}}}</p>
            {{/if}}


            {{#if equals contentType 'subsection'}}
            {{>ArticleFullTextSection}}
            {{/if}}

            {{#if equals contentType 'quote'}}
                {{#if content}}
                <blockquote>{{{content}}}</blockquote>
                {{/if}}
            {{/if}}

            {{#if equals contentType 'figure'}}
            <!-- Figure -->
                {{#with content}}
                {{>FullTextFigure}}
                {{/with}}
            {{/if}}

            {{#if equals contentType 'table'}}
            <!-- Table -->

                {{#if title}}
                <div class="table-title">{{{title}}}</div>
                {{/if}}

                <div class="article-table">
                    <table class="bordered" id="{{id}}">

                    {{{table}}}

                    {{#if tableGraphic}}
                    {{#with tableGraphic}}
                    {{>FullTextFigure}}
                    {{/with}}
                    {{/if}}

                    {{{footer}}}
                    </table>
                </div>
            {{/if}}

            {{#if equals contentType 'supplement'}}
            <!-- Supplemental -->
                {{#each supps}}

                {{#if url}}
                <h3 class="article-header-3"><a href="{{url}}" class="supplemental" id="{{id}}"><span class="icon icon-download"></span>{{#if label}}{{label}}{{else}}Supplemental File{{/if}}</a></h3>
                {{/if}}

                <p>{{#if title}}<span><b>{{{title}}}</b></span>{{/if}}{{#if caption}}<span>{{{caption}}}</span>{{/if}}</p>

                {{/each}}
            {{/if}}
        {{/each}}
    </div>
</template>

<template name="FullTextFigureText">
    <p class="small-font">{{#if label}}<span><b>{{{removePunctuation label}}}.</b></span>{{/if}} {{#if title}}<span><b>{{{title}}}.</b></span>{{/if}} {{{caption}}}</p>
</template>

<template name="FullTextFigure">
    <div class="full-text-image-container" id="{{id}}">
        {{#if url}}<a href="/figure/?article={{articleId}}&figure={{id}}" target="_blank"><img class="full-text-image" src="{{url}}"/></a>{{/if}}
        {{>FullTextFigureText}}
    </div>
</template>

<template name="ArticleGlossary">
    <h3 id="{{convertToID 'Abbreviations'}}" class="article-header-1">Abbreviations</h3>
    <p>
    {{#each glossary}}
        {{{term}}}: {{{def}}};
    {{/each}}
    </p>
</template>

<template name="FullTextReferenceConference">
    {{#if authors}}<span> {{{authors}}}.</span>{{/if}}
    {{#if title}}<span> {{{title}}}.</span>{{/if}}
    {{#if conf_name}}<span> {{{conf_name}}}.</span>{{/if}}
    {{#if year}}<span> {{year}}.</span>{{/if}}
    {{#if comment}}<span>{{{comment}}}</span>{{/if}}
</template>
