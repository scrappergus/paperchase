<template name="ArticleHeaderTitle">
    <h5 class="article-header">
        {{#if article_type.name}}
            <span class="article-type">{{article_type.name}}</span>
        {{/if}}
        {{#if issue_id}}
            <span>Volume {{volume}}{{#if issue}}, Issue {{issue}}{{/if}}</span>
        {{/if}}

        {{#if page_start}}<span>pp {{page_start}}{{#if page_end}} &ndash; {{page_end}}{{/if}}</span>{{/if}}
    </h5>

    <h1 id="article-title">{{{title}}}</h1>
</template>

<template name="ArticleHeader">
    {{>ArticleHeaderTitle}}
    {{>AuthorsRefList}}
    {{#if dates}} {{>ArticleDates}} {{/if}}

    <!-- todo: implement featured photo -->
    <!-- {{#if featuredPhoto}} -->
    <!-- <div class="featured-photo">
        <img src="/images/example-fig2.png" class="photo">
        <span class="dark tag">From <strong>Figure 2</strong></span>
    </div> -->
    <!-- {{/if}} -->



    <!-- {{#each arrayify ids}}
        {{#if equals name 'doi'}}
            <label>{{name}}:</label> <a href="{{value}}">{{prettyDoi value}}</a>
        {{else}}
            <label>{{name}}:</label> {{value}}
        {{/if}}
    {{/each}} -->


    <!-- {{>ArticleButtons _id=_id abstract=abstract files=files}} -->

    {{#if abstract}}
        <div class="abstract article-text">
            <h3 class="bordered article-header-1" id="abstract">Abstract</h3>
            <p>{{{abstract}}}</p>
            <div id="fulltext"></div>
        </div>
    {{/if}}
</template>

<template name="AuthorsList">
    <span class="authors">
        {{#each authors}}
            <span class="author">{{name_first}}{{#if name_middle}} {{name_middle}}{{/if}}{{#if name_last}} {{name_last}}{{/if}}<span class="comma">, </span></span>
        {{/each}}
    </span>
</template>

<template name="AuthorsRefList">
    <h2 class="authors">
        {{#each authors}}
            <span class="author">
                {{name_first}} {{#if name_middle}} {{name_middle}}{{/if}}{{#if name_last}} {{name_last}}{{/if}}
                {{#if affiliations_numbers}}
                    <sup class="author-affiliations">
                        {{#each affiliations_numbers}}
                            <span><a href="#" class="tooltip--triangle" data-tooltip="{{tooltipAffiliation}}">{{affiliationNumber .}}</a><span class="comma">,</span></span>
                        {{/each}}
                    </sup>
                {{/if}}
                <span class="comma">,</span>
            </span>
        {{/each}}
    </h2>
</template>


<template name="ArticleDates">
    <h2 class="authors">
        {{#each arrayify dates}}
            {{#if equals name 'collection'}}
                <span class="author">{{name}}: {{collectionDate value}}</span>
                {{else}}
                <span class="author">{{name}}: {{articleDate value}}</span>
            {{/if}}
        {{/each}}
    </h2>
</template>

<template name="ArticleSidebar">
    <div class="page-sidebar col s12 m12 l4">
        {{#if isSubscribed}}
            <!-- for subscribed users -->
            {{#if fullText}}
                {{#with files}}
                {{#if pdf.url}}
                    <a href="{{pdf.url}}" class="full-width end-cap primary button">
                        <span class="icon icon-download"></span> Download PDF
                    </a>
                {{/if}}
                {{/with}}
            {{else}}
                <a href="{{pathFor 'ArticleText' hash='fulltext'}}" class="full-width end-cap primary button">
                    <span class="icon icon-file"></span> View Full Text
                </a>
            {{/if}}
        {{else}}
            <!-- not subscribed -->
            {{#if fullText}}
                {{#with files}}
                {{#if pdf.url}}
                    <a href="{{pdf.url}}" class="full-width end-cap primary button">
                        <span class="icon icon-download"></span> Download PDF
                    </a>
                {{/if}}
                {{/with}}
            {{else}}
                <a href="#subscribe-modal" class="full-width end-cap primary button modal-trigger">
                    <span class="icon icon-file"></span> View Full Text
                </a>
            {{/if}}
        {{/if}}

        {{#if correspondence}}
            {{> ArticleCorrespondence}}
        {{/if}}

        {{#if keywords}}
            {{> ArticleKeywords}}
        {{/if}}

        {{#with files}}
        {{#if supplemental}}
            {{> ArticleSupplemental}}
        {{/if}}
        {{/with}}

        {{#if fullText}}
            {{> scrollspyCard title="Table of Contents" items=items abstract=abstract references=references}}
        {{/if}}
    </div>
</template>

<template name="ArticleCorrespondence">
    <div class="card sidebar-card">
        <h6 class="card-title">Corresponding Author</h6>
        <p>{{#if correspondence.[0].text}} {{correspondence.[0].text}}<br /> {{/if}}
        <a href="mailto:{{correspondence.[0].email}}">{{correspondence.[0].email}}</a></p>
    </div>
</template>

<template name="ArticleKeywords">
    <div class="card sidebar-card">
        <h6 class="card-title">Related Keywords</h6>
        <div class="tags">
            {{#each keywords}}
                <a class="keyword tag">{{{.}}}</a>
            {{/each}}
        </div>
    </div>
</template>

<template name="ArticleSupplemental">
    <div class="card sidebar-card">
        <h6 class="card-title">Supplemental Files</h6>
        <ul>
            {{#each supplemental}}
                {{#if label}}<li><a href="{{url}}" class="supplemental"><span class="icon icon-download"></span> {{label}}</a></li>{{/if}}
            {{/each}}
        </ul>
    </div>
</template>

<template name="ArticleFigures">
    <div class="owl-carousel">
    {{#each figures}}
        <div>
            <h4 class="center-align">{{{figureTitle}}}</h4>
            {{#each imgURLs}}<a href="/figure/?article={{articleId .}}&img={{.}}" target="_blank"><img src="{{.}}" width="100%;"></a>{{/each}}
            <!-- <p>{{{figureText}}}</p> -->
        </div>
    {{/each}}
    </div>
</template>

<template name="ArticleButtons">
    <div class="article-links">
        {{#if abstract}}<a class="small button" href="{{pathFor 'Article'}}">View Abstract</a>{{/if}}
        {{#if isSubscribed}}
            {{#with files}}

                {{#if pdf.url}}
                {{#if pdf.display}}
                <a data-id="{{_id}}" class="small button" href="{{pdf.url}}">PDF</a>
                {{/if}}
                {{/if}}

                {{#if xml.url}}
                {{#if xml.display}}
                <a data-id="{{_id}}" class="small button" href="http://52.20.223.77:4001/?id={{_id}}&journal={{journal}}">Lens Full-Text Viewer</a>
                <a data-id="{{_id}}" class="small button {{isActiveRoute 'ArticleText'}} {{#if isActiveRoute 'ArticleText'}}darken-4{{else}}darken-1{{/if}}" href="{{pathFor 'ArticleText'}}">Full-Text</a>
                {{/if}}
                {{/if}}

            {{/with}}
        {{else}}
            {{#with files}}

            {{#if pdf.file}}
                {{#if pdf.display}}
                <a data-id="{{_id}}" class="small button modal-trigger disabled" href="#subscribe-modal">PDF</a>
                {{/if}}
            {{/if}}

            {{#if xml.file}}
                {{#if xml.display}}
                <a data-id="{{_id}}" class="small button disabled modal-trigger" href="#subscribe-modal">Lens Full-Text Viewer</a>
                <a data-id="{{_id}}" class="small button disabled modal-trigger" href="#subscribe-modal">Full-Text</a>
                {{/if}}
            {{/if}}

            {{/with}}
        {{/if}}
    </div>
</template>

<!--admin partials-->
<template name="addArticleBtn">
    <button class="add-article btn waves-effect waves-light btn-add" type="submit" name="action" alt="Add Article"><i class="material-icons">&#xE147;</i> Add</button>
</template>
<template name="updateArticleBtn">
    <button data-mongoid="{{_id}}" class="update-article btn waves-effect waves-light btn-update" type="submit" name="action" alt="Update Article"><i class="material-icons">&#xE254;</i> Update</button>
</template>